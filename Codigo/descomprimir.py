import os
import zipfile

def descomprimir_archivo_zip(archivo_zip, carpeta_destino, contrasena):
    try:
        with zipfile.ZipFile(archivo_zip, 'r') as zip_ref:
            zip_ref.extractall(carpeta_destino, pwd=contrasena.encode('utf-8'))
        print(f'Descompresión exitosa: {archivo_zip}')
    except Exception as e:
        print(f'Error al descomprimir {archivo_zip}: {str(e)}')

def buscar_y_descomprimir_zip(directorio_raiz, carpeta_destino, contrasena):
    for carpeta_actual, _, archivos in os.walk(directorio_raiz):
        for archivo in archivos:
            if archivo.endswith('.zip'):
                ruta_completa = os.path.join(carpeta_actual, archivo)
                descomprimir_archivo_zip(ruta_completa, carpeta_destino, contrasena)

# Configuración
directorio_raiz = '/home/cape/Desktop/Ejercicio_1/Virus/theZoo/malware/Binaries'  # Cambia esto al directorio que desees explorar
carpeta_destino = '/home/cape/Desktop/Ejercicio_1/Virus/Samples'  # Cambia esto a la carpeta donde deseas almacenar las descompresiones
contrasena = 'infected'

# Buscar y descomprimir archivos ZIP
buscar_y_descomprimir_zip(directorio_raiz, carpeta_destino, contrasena)